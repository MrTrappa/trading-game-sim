<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MAC'S TRADING SIMULATOR CHALLENGE</title>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Titillium+Web:wght@700&display=swap" rel="stylesheet">
  <style>
    body { margin:0; background:#121212; color:#eee; font-family:'Inter',sans-serif; }
    h1 { text-align:center; color:gold; font-family:'Titillium Web',sans-serif; }
    .centered, #inputs, #status { text-align:center; }
    .chartLabel { font-family:'Titillium Web'; font-weight:bold; text-align:center; margin:8px 0; }
    .priceLabel{color:#1db954;} .volumeLabel{color:#27a368;} .rsiLabel{color:gold;}
    #chart,#volumeChart,#rsiChart{width:98vw; margin:10px auto; border-radius:12px;}
    input,select{background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.2); color:#fff; padding:10px; margin:8px; border-radius:6px;}
    button{background:linear-gradient(135deg,#1db954,#27a368);color:white;border:none;padding:12px 24px;margin:10px;font-size:1rem;border-radius:8px;cursor:pointer;}
    #leaderboard{background:rgba(255,215,0,0.08);border:1px solid gold;border-radius:12px;padding:15px;max-width:300px;margin:20px auto;}
  </style>
</head>
<body>

<h1>üíπ MAC'S TRADING SIMULATOR CHALLENGE üí∞</h1>

<audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c23e7cc82e.mp3"></audio>
<audio id="startSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_1d34671fdc.mp3"></audio>

<div id="inputs">
  <input type="text" id="playerName" placeholder="Enter your name"><br>
  <label for="modeSelect">Mode:</label>
  <select id="modeSelect" onchange="handleModeChange()">
    <option value="standard">Standard (5min)</option>
    <option value="timeAttack">Time Attack (2min, 50x/100x only)</option>
  </select><br>
  <label for="leverageSelect">Leverage:</label>
  <select id="leverageSelect">
    <option value="1">1x</option><option value="5">5x</option><option value="10" selected>10x</option><option value="20">20x</option><option value="50">50x</option><option value="100">100x</option>
  </select>
</div>

<div id="status">
  <p id="balance">Balance: $500</p>
  <p id="position">Position: None</p>
  <p id="unrealized">Unrealized PnL: $0</p>
  <p id="timer">Time Left: 300s</p>
</div>

<p class="chartLabel priceLabel">Price Chart</p>
<div id="chart"></div>
<p class="chartLabel volumeLabel">Volume Chart</p>
<div id="volumeChart"></div>
<p class="chartLabel rsiLabel">RSI Indicator</p>
<div id="rsiChart"></div>

<div class="centered">
  <button onclick="startGame()">START GAME</button>
  <button onclick="goLong()">GO LONG</button>
  <button onclick="goShort()">GO SHORT</button>
  <button onclick="closePosition()">CLOSE POSITION</button>
</div>

<div id="leaderboard">
  <h3>üèÜ Leaderboard</h3>
  <ul id="leaderboardList"></ul>
</div>

<script>
const clickSound = document.getElementById('clickSound');
const startSound = document.getElementById('startSound');
const API_URL = "https://sheetdb.io/api/v1/kaq8bevywrqfn";  // YOUR SheetDB link

let balance = 500, position = null, timeLeft = 300, timerId, intervalId, gameStarted = false, lastClose = 1900;
let candles=[],volumes=[],rsiValues=[];

const balanceDisplay=document.getElementById('balance');
const positionDisplay=document.getElementById('position');
const unrealizedDisplay=document.getElementById('unrealized');
const timerDisplay=document.getElementById('timer');

const chartColors={candlestick:{up:'#1db954',down:'#d9534f'},volume:{up:'rgba(40,167,69,0.6)'},rsi:'#FFD700'};

const chartOptions={chart:{type:'candlestick',height:300},series:[{name:'Price',data:[]}],xaxis:{type:'datetime'},theme:{mode:'dark'},legend:{show:true}};
const volumeOptions={chart:{type:'bar',height:120},series:[{name:'Volume',data:[]}],xaxis:{type:'datetime'},colors:[chartColors.volume.up],theme:{mode:'dark'},legend:{show:true}};
const rsiOptions={chart:{type:'line',height:120},series:[{name:'RSI',data:[]}],xaxis:{type:'datetime'},yaxis:{min:0,max:100},colors:[chartColors.rsi],theme:{mode:'dark'},legend:{show:true}};

const chart=new ApexCharts(document.querySelector("#chart"),chartOptions);
const volumeChart=new ApexCharts(document.querySelector("#volumeChart"),volumeOptions);
const rsiChart=new ApexCharts(document.querySelector("#rsiChart"),rsiOptions);
chart.render();volumeChart.render();rsiChart.render();

function generateNextCandle(prevClose){const o=prevClose,h=o+Math.random()*2,l=o-Math.random()*2,c=l+Math.random()*(h-l);return{y:[o,h,l,c]};}
function calculateRSI(closes){if(closes.length<15)return 50;let g=0,l=0;for(let i=closes.length-14;i<closes.length;i++){const d=closes[i]-closes[i-1];if(d>=0)g+=d;else l-=d;}const rs=g/(l||1);return 100-(100/(1+rs));}
function generateHistory(sp,n){let d=[],v=[],r=[],p=sp,cl=[p],t=new Date(Date.now()-n*60000);for(let i=0;i<n;i++){const c=generateNextCandle(p);c.x=new Date(t.getTime()+i*60000);d.push(c);const vol=Math.floor(100+Math.abs(c.y[3]-c.y[0])*50);v.push({x:c.x,y:vol});cl.push(c.y[3]);r.push({x:c.x,y:calculateRSI(cl)});p=c.y[3];}lastClose=p;return{candles:d,volumes:v,rsi:r};}

function startGame(){startSound.play();const name=document.getElementById('playerName').value.trim();if(!name){alert("Enter your name!");return;}clearInterval(intervalId);clearTimeout(timerId);
balance=500;timeLeft=mode==='timeAttack'?120:300;position=null;const h=generateHistory(1900,120);
candles=h.candles;volumes=h.volumes;rsiValues=h.rsi;
chart.updateSeries([{name:'Price',data:candles}]);
volumeChart.updateSeries([{name:'Volume',data:volumes}]);
rsiChart.updateSeries([{name:'RSI',data:rsiValues}]);
balanceDisplay.textContent=`Balance: $${balance.toFixed(2)}`;
positionDisplay.textContent=`Position: None`;
unrealizedDisplay.textContent=`Unrealized PnL: $0`;
timerDisplay.textContent=`Time Left: ${timeLeft}s`;
intervalId=setInterval(updateChart,3000);
countdown();
}

function updateChart(){const n=generateNextCandle(lastClose);const t=candles[candles.length-1].x;n.x=new Date(t.getTime()+60000);candles.push(n);chart.updateSeries([{name:'Price',data:candles}]);
const vol=Math.floor(100+Math.abs(n.y[3]-n.y[0])*50);volumes.push({x:n.x,y:vol});volumeChart.updateSeries([{name:'Volume',data:volumes}]);
const closes=candles.map(c=>c.y[3]);const rsiVal=calculateRSI(closes);rsiValues.push({x:n.x,y:rsiVal});rsiChart.updateSeries([{name:'RSI',data:rsiValues}]);lastClose=n.y[3];updateUnrealizedPnL();}

function goLong(){clickSound.play();if(!gameStarted)return;if(!position){const lev=parseInt(document.getElementById('leverageSelect').value);position={type:'LONG',entryPrice:lastClose,leverageUsed:lev};
positionDisplay.textContent=`Position: LONG @ $${position.entryPrice.toFixed(2)} (x${lev})`;}else{alert('Already holding a position!');}}

function goShort(){clickSound.play();if(!gameStarted)return;if(!position){const lev=parseInt(document.getElementById('leverageSelect').value);position={type:'SHORT',entryPrice:lastClose,leverageUsed:lev};
positionDisplay.textContent=`Position: SHORT @ $${position.entryPrice.toFixed(2)} (x${lev})`;}else{alert('Already holding a position!');}}

function closePosition(){clickSound.play();if(!gameStarted)return;if(position){const exit=lastClose;let prof=0;if(position.type==='LONG'){prof=(exit-position.entryPrice)*position.leverageUsed;}
else{prof=(position.entryPrice-exit)*position.leverageUsed;}balance+=prof;balanceDisplay.textContent=`Balance: $${balance.toFixed(2)}`;alert(`Closed ${position.type} for ${prof>=0?'+':''}${prof.toFixed(2)} (x${position.leverageUsed})`);
position=null;positionDisplay.textContent=`Position: None`;unrealizedDisplay.textContent=`Unrealized PnL: $0`;}else{alert('No open position!');}}

function updateUnrealizedPnL(){if(position){let pnl=0;if(position.type==='LONG')pnl=(lastClose-position.entryPrice)*position.leverageUsed;
else pnl=(position.entryPrice-lastClose)*position.leverageUsed;unrealizedDisplay.textContent=`Unrealized PnL: $${pnl.toFixed(2)} (x${position.leverageUsed})`;}
else unrealizedDisplay.textContent=`Unrealized PnL: $0`;}

function countdown(){if(timeLeft<=0){clearInterval(intervalId);alert(`Game Over! Final Balance: $${balance.toFixed(2)}`);
saveToLeaderboard(balance,document.getElementById('playerName').value.trim());}else{timeLeft--;timerDisplay.textContent=`Time Left: ${timeLeft}s`;timerId=setTimeout(countdown,1000);}}

function saveToLeaderboard(finalBalance,name){
fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},
body:JSON.stringify({data:[{name,balance:finalBalance}]})}).then(()=>loadLeaderboard());
}

function loadLeaderboard(){
fetch(API_URL).then(r=>r.json()).then(data=>{
data.sort((a,b)=>parseFloat(b.balance)-parseFloat(a.balance));
const list=document.getElementById('leaderboardList');
list.innerHTML='';
data.slice(0,5).forEach((e,i)=>{
const li=document.createElement('li');
li.textContent=`#${i+1}: ${e.name} - $${parseFloat(e.balance).toFixed(2)}`;
list.appendChild(li);
});
});
}

function handleModeChange(){
const mode=document.getElementById('modeSelect').value;
const leverageSelect=document.getElementById('leverageSelect');
leverageSelect.innerHTML='';
if(mode==='timeAttack'){leverageSelect.innerHTML+='<option value="50">50x</option><option value="100">100x</option>';}
else{leverageSelect.innerHTML+='<option value="1">1x</option><option value="5">5x</option><option value="10" selected>10x</option><option value="20">20x</option><option value="50">50x</option><option value="100">100x</option>';}
}
loadLeaderboard();
</script>

</body>
</html>
